# top 命令輸出的資訊介紹

`top` 是 Linux/Unix 系統中一個常用的交互式系統監控工具，用來即時顯示系統資源使用情況，包括 CPU、記憶體、交換空間和運行中的進程列表，執行 `top` 命令後，畫面會分為兩個主要部分：**系統摘要（上方幾行）** 和 **進程列表（下方表格）**。以下詳細說明輸出的各部分資訊（基於標準的 top 輸出格式，實際顯示可能因版本或設定略有差異）。

<img width="695" height="396" alt="image" src="https://github.com/user-attachments/assets/5b10b9ee-4984-44cf-8687-59f5d7368f09" />

## 1. 系統摘要部分

這部分提供系統整體狀態的概覽，每隔幾秒（預設 3 秒）自動更新。

- **第一行：系統時間與負載**：

  - 當前系統時間（例如：`top - 14:30:45`）。
  - 系統運行時間（uptime，例如：`up 1 day, 2:30` 表示已運行 1 天 2 小時 30 分）。
  - 登入使用者數（例如：`2 users`）。
  - 負載平均值（load average，例如：`load average: 0.15, 0.20, 0.25`），分別代表過去 1 分鐘、5 分鐘、15 分鐘的系統平均負載。這是衡量系統忙碌程度的指標，通常以 CPU 核心數為基準（例如，負載 1.0 表示滿載）。

- **第二行：任務/進程總覽**：

  - 總任務數（tasks，例如：`Tasks: 150 total`）。
  - 運行中進程（running，例如：`1 running`）。
  - 睡眠中進程（sleeping，例如：`149 sleeping`）。
  - 停止進程（stopped，例如：`0 stopped`）。
  - 僵屍進程（zombie，例如：`0 zombie`）。僵屍進程是已結束但父進程未回收的進程，可能表示程式錯誤。

- **第三行：CPU 使用情況**：

  - CPU 總使用率分解（例如：`%Cpu(s): 5.0 us, 3.0 sy, 0.0 ni, 90.0 id, 2.0 wa, 0.0 hi, 0.0 si, 0.0 st`）。
    - `us`：使用者空間 CPU 使用率（用戶程式執行時間）。
    - `sy`：系統空間 CPU 使用率（内核操作時間）。
    - `ni`：nice 優先級調整的 CPU 使用率（用戶進程優先級調整）。
    - `id`：閒置 CPU 率（空閒時間）。
    - `wa`：I/O 等待率（等待磁碟/網路 I/O 的時間）。
    - `hi`：硬體中斷處理時間。
    - `si`：軟體中斷處理時間。
    - `st`：虛擬化偷取時間（在虛擬環境中，被 hypervisor 偷走的 CPU 時間）。

- **第四行：物理記憶體使用**：

  - 總物理記憶體（例如：`MiB Mem : 8192 total`）。
  - 可用記憶體（free，例如：`2000 free`）。
  - 已使用記憶體（used，例如：`5000 used`）。
  - 緩衝/快取（buff/cache，例如：`1192 buff/cache`），這是系統用來加速 I/O 的記憶體，可回收。

- **第五行：交換空間使用**：
  - 總交換空間（例如：`MiB Swap: 2048 total`）。
  - 可用交換空間（free，例如：`2048 free`）。
  - 已使用交換空間（used，例如：`0 used`）。
  - 可用記憶體估計（avail Mem，例如：`6000 avail Mem`），這是系統估計的真正可用記憶體（包括可回收部分）。

## 2. 進程列表部分

這是動態排序的進程表格，按 CPU 使用率預設排序（可互動調整）。每列代表一個進程，欄位包括：

| 欄位    | 說明                                                           |
| ------- | -------------------------------------------------------------- |
| PID     | 進程 ID（唯一識別碼，用來殺進程等操作）。                      |
| USER    | 擁有該進程的使用者。                                           |
| PR      | 優先級（priority，數值越低優先級越高）。                       |
| NI      | nice 值（-20 到 19，用來調整優先級，負值表示更高優先級）。     |
| VIRT    | 虛擬記憶體使用量（包括所有映射的記憶體）。                     |
| RES     | 駐留記憶體使用量（實際佔用的物理記憶體）。                     |
| SHR     | 共享記憶體使用量（可被多進程共享的部分）。                     |
| S       | 進程狀態（R=運行, S=睡眠, D=不可中斷睡眠, Z=僵屍, T=停止）。   |
| %CPU    | 該進程的 CPU 使用率。                                          |
| %MEM    | 該進程的記憶體使用率。                                         |
| TIME+   | 進程累計 CPU 時間（格式如 hh:mm:ss）。                         |
| COMMAND | 進程命令名稱或完整命令行（使用 `-c` 選項可切換顯示完整命令）。 |

在 top 介面中，你可以互動操作，例如：

- 按 `k` 殺進程（輸入 PID）。
- 按 `M` 按記憶體排序、`P` 按 CPU 排序、`N` 按 PID 排序。
- 按 `1` 顯示每個 CPU 核心的使用情況。
- 按 `q` 退出。

這些資訊來自 Linux 的 proc 檔案系統（/proc），top 會即時讀取並顯示。

### 相關問題

1. **top 命令是什麼？如何啟動它？**

   - 回答：top 是即時監控系統進程和資源的工具。啟動方式：直接輸入 `top`，或帶選項如 `top -d 1`（每秒更新）、`top -p 1234`（監控特定 PID）、`top -u user`（只顯示特定使用者進程）。

2. **解釋 top 輸出的 load average 是什麼？如何判斷系統是否過載？**

   - 回答：Load average 是過去 1/5/15 分鐘的平均 runnable 進程數。如果 load > CPU 核心數（用 `nproc` 查），表示系統忙碌；例如，4 核心系統 load=5 表示過載。

3. **在 top 的 CPU 行中，us、sy、id、wa 分別代表什麼？如果 wa 很高，可能是什麼問題？**

   - 回答：us=使用者 CPU, sy=系統 CPU, id=閒置, wa=I/O 等待。高 wa 可能表示磁碟/網路瓶頸，需檢查 I/O 裝置。

4. **什麼是僵屍進程（zombie）？在 top 中看到 zombie 進程該怎麼處理？**

   - 回答：Zombie 是已結束但未被父進程回收的子進程。處理：找出父進程（用 `ps -o ppid= -p <zombie_pid>`），殺父進程或等待它回收。

5. **如何在 top 介面中殺掉一個進程？**

   - 回答：按 `k`，輸入 PID，選擇信號（預設 15 SIGTERM，嚴重時用 9 SIGKILL）。

6. **top 顯示的記憶體使用中，buff/cache 是什麼？它和 used/free 有什麼關係？**

   - 回答：Buff/cache 是用於加速 I/O 的可回收記憶體。Used = total - free - buff/cache（真正已佔用）；高 buff/cache 不一定是問題，因為可釋放。

7. **如果系統記憶體使用率很高，但 CPU 閒置，可能是什麼原因？如何用 top 調查？**

   - 回答：可能記憶體洩漏或大量睡眠進程。按 `M` 排序記憶體，檢查高 %MEM 進程。

8. **top 和 ps 命令有什麼區別？什麼情況下用 top？**

   - 回答：ps 是靜態快照，top 是動態即時。top 用於持續監控性能瓶頸。

9. **如何自訂 top 的顯示？例如，只顯示前 10 個進程或改變更新間隔。**

   - 回答：用 `top -n 10`（執行 10 次後退出），或在介面按 `d` 改變延遲。儲存設定：按 `W` 寫入 ~/.toprc。

10. **在生產環境中，top 顯示高 CPU 使用率時，你會如何故障排除？**
    - 回答：步驟：檢查高 %CPU 進程，分析 COMMAND；用 `strace` 或 `perf` 深入；檢查是否多核心（按 `1`）；考慮負載平衡或升級硬體。

---

# 什麼是 CIDR？ 什麼是子網遮罩 Subnet Mask ？

IPv4 位址本質上是一個 32 位元（bit）的二進位數字

<img width="340" height="520" alt="image" src="https://github.com/user-attachments/assets/73c61481-7330-4d32-9a74-679af5925438" />

```text
105.168.114.0
= 01101001.10101000.01110010.00000000
```

## 什麼是 CIDR 的 /N

CIDR 使用 /N 來表示：

> 前 N 個 bit 是網路位（network bits）
>
> 剩下的 (32 − N) 個 bit 是主機位（host bits）

也就是說：

/N 越大 → 網路越小、主機越少

/N 越小 → 網路越大、主機越多

## IP 後面的 /24 是什麼意思？

### Example:

```
105.168.114.0
```

拆成四個 octet：

```
105     .168     .114     .0
8 bits   8 bits   8 bits   8 bits
```

/24 的意思是：

```
[ 105 ][ 168 ][ 114 ] | [ host ]
   8      8      8        8
```

也就是前三段固定，最後一段是主機號

所以：

```
105.168.114.0/24
```

代表的範圍就是：

```
105.168.114.0  ~ 105.168.114.255
```

剛好 256 個 IP

| CIDR | 主機位 | IP 數量    | 備註     |
| ---- | ------ | ---------- | -------- |
| /32  | 0      | 1          | 單一 IP  |
| /24  | 8      | 256        | 最常見   |
| /16  | 16     | 65,536     | 大型內網 |
| /8   | 24     | 16,777,216 | ISP 等級 |
